<!DOCTYPE html>
<html> 

<head>
  <meta charset="utf-8" />
  <meta name="description" content="Wyatt Stanley" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

  <title>Wyatt Stanley</title>
  <!-- <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,500;1,400;1,500&display=swap" /> -->
  <!-- <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css"> -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"> -->
  <link rel="stylesheet" href="css/main.css">
  <script src="https://unpkg.com/scrollama"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>

<body>
  <!-- loading a video cover page -->
  <section id="cover">
    <!-- loading a video as the background -->
    <video class="fullscreen canvas-center" playsinline="" autoplay="" muted="" loop="">
      <source src="assets/orca.mp4" type="video/mp4">
    </video>
    <div id="intro">
      <h1>A GeoNarrative Template</h1>
      <h5>Saving the Chinnok to Save the Orcas</h5>
      <p>Chinook salmon, a once plentiful species in the Pacific Northwest, occupied the Puget Sound and Columbia River (Hanson, 2021). 
        Since the 1970’s, these salmon populations of the Northeastern Pacific have experienced a decline in abundance and productivity. 
        (Couture, 2022). Many factors aid to this decline, including global warming, which has heated British Columbias Fraser River ~1.8 
        degrees F from 1953 to 1998, killing 50% of that river’s sockeye salmon (Olsen, 2022).</p>

      <div class="footnote">
        <span><a href="https://stock.adobe.com">Video Source</a></span>
      </div>
    </div>
  </section>
  <!-- a geonarrative will have two major components, a storyboard and a script panel of a series of scenes/actions -->
  <section id="geonarrative">
    <!-- a storymap can present differnt types of objects, like map, chart, diagram, etc. -->
    <div id="storyboard">
      <!-- create the place holder element for map -->
      <div id="map"></div>
    </div>

    <article class="scene" data-scene="0">
      <h2>1: Puget Sound Killer Whales</h2>
        <p>
            “Seeing killer whales ply the waters of Washington state's Puget Sound has long been a great thrill for Seattle-area residents.
             No other U.S. urban community can boast of resident orcas a few miles from downtown. Whale watching there is a multi-million-dollar 
            tourist draw. As one orca expert puts it, ‘Everybody wants a kiss from a killer whale’” (Olsen, 2006, p. 1).
            <br>
            <br>
            Killer whales are a cultural and historical icon to the Pacific Northwest, living together with indigenous people in the Puget Sound
             for 5000 years (EPA, 2023). No other community in the U.S. has the Puget Sound, a specific landscape to Washington that is ideal
              for the north resident killer whales. Without historically abundant food sources there has been a decline in killer whale populations. 
        </p>
        <img class="img" src="img/orcaphoto.jpg" style="width: 50%; height: auto; display: block; margin: 0 auto; box-shadow: 0px 4px 8px rgba(0, 0, 0, 1);"></img>
        <p><a href="https://unsplash.com">Photo Source</a> <a href="https://geo.wa.gov/datasets/34764715c1254a639b831f3c9de92417_3/explore?location=48.017796%2C-122.718350%2C8.67">Data Source</a></p>
    </article>
    <article class="scene" data-scene="1">
      <h2>2: The Link Between Predator and Prey</h2>
            <p>
                Killer whales living in the Puget Sound have a strong ecological link
                with direct evidence stating that north resident killer whale group size directly correlates to Chinook salmon abundance
                (Williams, 2011). 
                <br>
                <br>
                Puget Sound’s toxicity from “pulp, paper mills, oil refineries, ports, boatyards, and storm-water runoff” 
                (Olsen, 2022, p. 3), and degradation of freshwater habitats (Couture, 2022) has ruined nearshore salmon habitat.
                Without sufficient abundance in Washington..., population recovery for these whales
                is impossible (Hanson, 2021). 
                <br>
            </p>
            <br>
            <br>
            <img class="img" src="img/trash.jpeg" style="width: 50%; height: auto; display: block; margin: 0 auto; box-shadow: 0px 4px 8px rgba(0, 0, 0, 1);"></img>
            <p><a href="https://unsplash.com">Photo Source</a> <a href="https://geo.wa.gov/datasets/34764715c1254a639b831f3c9de92417_3/explore?location=48.017796%2C-122.718350%2C8.67">Data Source</a></p>
    </article>
    <article class="scene" data-scene="2">
      <h2>3: Comprimised Salmon Habitat</h2>
        <p>
            This map displays the freashwater range of Chinook Salmon, these rivers have also been comprimised by the include dams, which block 
            salmon migration. Due to changes in habitiat such as these, half the Chinook salmon in British Columbia have 
            a spawning abundance so low that they are not likely to hit the biological benchmark to sustain those populations.  In the USA, 
            most Chinook salmon coming from the Columbia and Sacramento Rivers are listed as endangered or threatened under the Endangered 
            Species Act. (Couture, 2022)
            <br>
            <br>
            In the fall, salmon makes up 50% of killer whale diets. In winter to early spring, this percent increases to
             70-80%. In the spring, salmon makes up 100% of north resident killer whales when abundant (Hanson, 2021). In the mid-1990s,
              when wild chinook population declined, there was a population decrease in north resident killer whales from 219 in 1995 to
               202 in 2001 (Olsen, 2006). This correlation becomes important when considering habitat and salmon conservation. Without concervation
               effots for salmon habitat, there is no recovery for the north resident killer whales.
        </p>
        <p><a href="https://geo.wa.gov/datasets/waecy::washington-coast-chinook-salmon/explore?location=45.581300%2C-118.865825%2C6.05">Data Source</a></p>
    </article>

    <article class="scene" data-scene="3">
      <h2>4: Sensative Marine Areas </h2>
        <p>
            This map displays Sensitive Aquatic Areas in Washinton. Disruptions in these areas can have nevgative effects of wildlife such as 
            Chinook Salmon. In order to save Washington salmon and north resident killer whales, areas such as these need to be respected.
            Without proper maintenence to these areas, these iconic and culturally significan animals may go extinct. 
            
        </p>
        <br>
        <br>
        <br>
        <img class="img" src="img/cleaning.jpeg" style="width: 50%; height: auto; display: block; margin: 0 auto; box-shadow: 0px 4px 8px rgba(0, 0, 0, 1);"></img>
        <br>
        <br>
        <br>
        <br>
        <p><a href="https://unsplash.com">Photo Source</a> <a href="https://geo.wa.gov/datasets/WSDOT::wsdot-sensitive-aquatic-areas/explore?location=47.220999%2C-120.767400%2C7.36">Data Source</a></p>
    </article>
    <article class="scene" data-scene="4">
      <h2>Data Sources:</h2>
      <p>
        Couture, F. et al. (2022) ‘Requirements and availability of prey for northeastern pacific southern resident killer whales’, PLoS ONE, 17(6), pp. 1–26. doi:10.1371/journal.pone.0270523.
        <br>
        <br>
        (EPA) Environmental Protection Agency (2023) ‘South Resident Killer Whales’, EPA, https://www.epa.gov/salish-sea/southern-resident-killer-whales 
        <br>
        <br>
        Hanson, M.B. et al. (2021) ‘Endangered predators and endangered prey: Seasonal diet of Southern Resident killer whales’, PLoS ONE, 16(3), pp. 1–27. doi:10.1371/journal.pone.0247031.
        <br>
        <br>
        Olsen, K. (2006) ‘Orcas on the Edge’, National Wildlife, 44(6), pp. 22–30. https://search-ebscohostcom.offcampus.lib.washington.edu/login.aspx?direct=true&db=a9h&AN=22619968&site=ehost-live 
        <br>
        <br>
        Williams, R. et al. (2011) ‘Competing Conservation Objectives for Predators and Prey: Estimating Killer Whale Prey Requirements for Chinook Salmon’, PLoS ONE, 6(11), pp. 1–9. doi:10.1371/journal.pone.0026738.
      </p>
      <hr>

    </article>



  </section>

  <section id="footer">
    <h2>Wyatt Stanley</h2>
  </section>


  <script>
    // 1. Declare the maps, script panels, and different thematic layers.
    let map, scriptPanel = scrollama(), countiesLayer, cellTowersLayer, sensitiveLayer;

    // 2. Intialize the layout.
   
    history.scrollRestoration = "manual"; // make sure the geo-narrative will be scrolled to the cover page even after a page refresh.
    window.scrollTo(0, 0); // scroll the geo-narrative to the coverpage
    adjustStoryboardlSize(); // force a browser window resize.
    window.addEventListener("resize", adjustStoryboardlSize); // // ask the browser window listen to the resize event, thereby force a viewport resize whenever adjusting the window size.

    // 3. Define Generic window resize listener event
    function adjustStoryboardlSize() {

      const scenes = document.getElementsByClassName("scene");
      const storyboard = document.getElementById("storyboard");

      // 3.1 determine the height of each scene element
      let sceneH = Math.floor(window.innerHeight * 0.75);
      for (const scene of scenes) {
        scene.style.height = sceneH + "px";
      }
      
      // 3.2 determin the height of the storyboard.
      let storyboardHeight = window.innerHeight;
      let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;

      storyboard.style.height = storyboardHeight + "px";
      storyboard.style.top = storyboardMarginTop + "px"

      // 3.3 tell scrollama/script panel to update new element dimensions
      scriptPanel.resize();
    }

    // 4. Initialize the mapbox
    mapboxgl.accessToken =
      'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw'; // Assign the access token
   
    map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/light-v10',
      zoom: 7, // starting zoom
      minZoom: 3,
      maxZoom: 10,
      center: [-121.93, 47.33], // starting center
      scrollZoom: false,
      boxZoom: false,
      doubleClickZoom: false
    });  // Declare the map object

    // An alternative way to disable map zoom when using scroll
    // map.scrollZoom.disable();


    // 5. define the asynchronous function to load geojson data and then performs the dependent actions.
    async function geojsonFetch() {

      // 6 wait till the data of washington counties and celltowers are fully loaded.
      let response, celltowers, counties, sensitive;
      response = await fetch("assets/wacountydata.geojson");
      counties = await response.json();
      response = await fetch("assets/celltowers.geojson");
      celltowers = await response.json();
      response = await fetch("assets/sensitive.geojson");
      sensitive = await response.json();


      // 7. Trigger operations inside of the the ()=> {} funciton while loading the map.
      map.on('load', () => {

        // 8. add map source and declare layers.
        map.addSource('celltowers-src', {
          type: 'geojson',
          data: celltowers
        });

        map.addSource('counties-src', {
          type: 'geojson',
          data: counties
        });

        map.addSource('sensitive-src', {
          type: 'geojson',
          data: sensitive
        });

        //declare layers

        countiesLayer = {
          'id': 'counties-polygons',
          'type': 'fill',
          'source': 'counties-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#000000',
            'fill-opacity': 0.5
          }
        };


        cellTowersLayer = {
          'id': 'celltowers-polygons',
          'type': 'fill',
          'source': 'celltowers-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#000000',
            'fill-opacity': 0.5

          }
        };

        sensitiveLayer = {
          'id': 'sensitive-polygons',
          'type': 'fill',
          'source': 'sensitive-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#000000',
            'fill-opacity': 0.5

          }
        };



        // 9. Initialize the script panel
        scriptPanel
          .setup({
            step: ".scene", // all the scenes.
            offset: 0.33, // the location of the enter and exit trigger
            debug: false // toggler on or off the debug mode.
          })
          .onStepEnter(handleSceneEnter)
          .onStepExit(handleSceneExit);
        
        // 10. This function performs when a scene enters the storyboard
        function handleSceneEnter(response) {

          var index = response.index; // capture the id of the current scene. 

          if (index === 0) { // When enter the first scene

            map.flyTo({
              center: [-122.85, 47.6131229],
              zoom: 9.5,
              pitch: 0,
              speed: 0.5
            }); // fly to a new location
            
            if (typeof (map.getSource('celltowers-src')) == 'undefined') { //if the map source 'counties-src' does not exist
              map.addSource('celltowers-src', {
                type: 'geojson',
                data: celltowers
              }); // reload the map source of 'counties-src'
            } else {
              map.getSource('counties-src').setData(celltowers); // if the map source does not exist, relaod the data counties to the pre-defined map source 'counties-src'.

            }

            if (!map.getLayer("celltowers-polygons")) { // if the map layer 'counties-polygons' does not exit
              map.addLayer(cellTowersLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page
        

        } else if (index === 1) { // When enter the second scene.
            map.flyTo({
              center: [-123, 47.33],
              zoom: 910,
              pitch: 65,
              speed: 0.45
            });

            if (typeof (map.getSource('celltowers-src')) == 'undefined') {
              map.addSource('celltowers-src', {
                type: 'geojson',
                data: celltowers
              });
            } else {
              map.getSource('celltowers-src').setData(celltowers);

            }

            if (!map.getLayer("celltowers-polygons")) {
              map.addLayer(cellTowersLayer);
            }

            
          } else if (index === 2) {
            //Relocate to Seattle
            map.flyTo({
              center: [-124.93, 47.33],
              zoom: 7.5,
              pitch: 30,
              speed: 0.45

            });

            if (typeof (map.getSource('counties-src')) == 'undefined') {
              map.addSource('counties-src', {
                type: 'geojson',
                data: counties
              });
            } else {
              map.getSource('counties-src').setData(counties);

            }

            if (!map.getLayer("counties-polygons")) {
              map.addLayer(countiesLayer);
            }

          } else if (index === 3) {

            map.flyTo({
              center: [-124.93, 47.33],
              zoom: 6,
              pitch: 20,
              speed: 0.5
            
            });

            if (typeof (map.getSource('sensitive-src')) == 'undefined') {
              map.addSource('sensitive-src', {
                type: 'geojson',
                data: sensitive
              });
            } else {
              map.getSource('sensitive-src').setData(sensitive);

            }

            if (!map.getLayer("sesitive-polygons")) {
              map.addLayer(sensitiveLayer);
            }

          } else if (index === 6) {

            map.flyTo({
              center: [-122.4121036, 47.6131229],
              zoom: 7,
              pitch: 0,
              speed: 0.5

            });


          }
        }

        // 11. This function performs when a scene exists the storyboard
        function handleSceneExit(response) {
          var index = response.index;

          if (index === 0) {
            if (map.getLayer("celltowers-polygons")) {
              map.removeLayer('celltowers-polygons');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            }

          } else if (index === 1) {
            if (map.getLayer("celltowers-polygons")) {
              map.removeLayer('celltowers-polygons');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            }
          } else if (index === 2) {
            if (map.getLayer("counties-polygons")) {
              map.removeLayer('counties-polygons');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            }

          } else if (index === 3) {
            if (map.getLayer("sensitive-polygons")) {
              map.removeLayer('sensitive-polygons');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            }
          }
        }


        });

    };

    // 5 call the data loading function.
    geojsonFetch();
  </script>
</body>

</html>